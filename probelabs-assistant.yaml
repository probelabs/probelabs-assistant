# =============================================================================
# ProbeLabs Assistant - Unified Skills Architecture
# =============================================================================
#
# AI assistant for ProbeLabs, helping developers explore and work with
# the ProbeLabs product ecosystem: Probe, Visor, GoReplay, and developer tools.
#
# Based on the Visor-EE workflow engine with unified skills.
#
# Configuration files:
#   - config/intents.yaml   - Intent definitions (high-level routing)
#   - config/skills.yaml    - Unified skills (knowledge, servers, code_config with projects)
#
# =============================================================================

version: "1.0"

# Import the high-level assistant workflow from visor-ee
imports:
  - https://raw.githubusercontent.com/probelabs/visor-ee/master/workflows/assistant.yaml
  - workflows/engineer.yaml

workspace:
  enabled: true
  cleanup_on_exit: true

slack:
  version: "v1"
  mentions: all
  threads: required
  show_raw_output: true
  allow_bot_messages: true
  telemetry:
    enabled: true

scheduler:
  enabled: true
  storage:
    path: .visor/schedules.json
  default_timezone: UTC
  limits:
    max_per_user: 25
    max_recurring_per_user: 10
    max_global: 1000
  permissions:
    allow_personal: true
    allow_channel: true
    allow_dm: true

checks:
  chat:
    type: workflow
    criticality: policy
    workflow: assistant
    assume:
      - "conversation.current.text != null"
    guarantee: "output?.text != null"
    args:
      question: "{{ conversation.current.text }}"

      system_prompt: |
        You are the ProbeLabs AI Assistant, helping developers explore and work with
        ProbeLabs products: Probe (semantic code search), Visor (AI code review),
        GoReplay (HTTP traffic replay), and the suite of AI developer tools.

      # Intent definitions (high-level routing)
      intents:
        expression: "loadConfig('config/intents.yaml')"

      # Unified skills
      skills:
        expression: "loadConfig('config/skills.yaml')"

# =============================================================================
# Tests
# =============================================================================
# Integration tests for the full assistant pipeline (intent routing, skill
# activation, Slack context) require the visor-ee engine and run via:
#   visor run --tags test probelabs-assistant.yaml
#
# Standalone workflow tests (engineer, etc.) run via:
#   visor test
